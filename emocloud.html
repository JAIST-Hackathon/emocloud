<!DOCTYPE html>
<html>
  <head>
    <title>æ„Ÿæƒ…ã‚¯ãƒ©ã‚¦ãƒ‰ãƒãƒƒãƒ—</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Tailwind CSS CDNã‚’èª­ã¿è¾¼ã¿ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Interãƒ•ã‚©ãƒ³ãƒˆã‚’Google Fontsã‹ã‚‰èª­ã¿è¾¼ã¿ -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* å…¨ä½“çš„ãªãƒšãƒ¼ã‚¸ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
      body {
        font-family: "Inter", sans-serif;
        display: flex;
        flex-direction: column; /* è¦ç´ ã‚’ç¸¦æ–¹å‘ã«ä¸¦ã¹ã‚‹ */
        height: 100vh; /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®é«˜ã•å…¨ä½“ã‚’ä½¿ç”¨ */
        margin: 0;
        padding: 0;
        overflow: hidden; /* å…¨ä½“çš„ãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ç¦æ­¢ */
      }

      /* åœ°å›³ã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #map-container {
        position: relative;
        flex-grow: 1; /* åœ°å›³ã‚³ãƒ³ãƒ†ãƒŠãŒåˆ©ç”¨å¯èƒ½ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’ã™ã¹ã¦å ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ */
        width: 100%;
        overflow: hidden; /* åœ°å›³ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’éš ã™ */
      }

      /* åœ°å›³è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #map {
        height: 100%;
        width: 100%;
      }

      /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #controls {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(255, 255, 255, 0.9); /* åŠé€æ˜ã®ç™½èƒŒæ™¯ */
        padding: 8px;
        border-radius: 8px;
        z-index: 2; /* åœ°å›³ã®ä¸Šã«è¡¨ç¤º */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* å½± */
      }

      /* åœ°å›³æ“ä½œãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #toggleMapControl {
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 6px 10px;
        border-radius: 8px;
        z-index: 2; /* åœ°å›³ã®ä¸Šã«è¡¨ç¤º */
        background-color: #007aff; /* é’è‰²ã®èƒŒæ™¯ */
        color: white;
        border: none;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      }

      /* æ„Ÿæƒ…å…¥åŠ›UIã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #emotion-input-container {
        position: fixed; /* ç”»é¢ä¸‹éƒ¨ã«å›ºå®š */
        bottom: 0;
        left: 0;
        width: 100%;
        background: rgba(255, 255, 255, 0.95); /* åŠé€æ˜ã®ç™½èƒŒæ™¯ */
        padding: 1rem 0;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1); /* ä¸Šå‘ãã®å½± */
        z-index: 10; /* ä»–ã®è¦ç´ ã®ä¸Šã«è¡¨ç¤º */
        display: flex;
        flex-direction: column; /* è¦ç´ ã‚’ç¸¦æ–¹å‘ã«ä¸¦ã¹ã‚‹ */
        align-items: center; /* ä¸­å¤®æƒãˆ */
        gap: 0.75rem; /* è¦ç´ é–“ã®éš™é–“ */
      }

      /* æ„Ÿæƒ…ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠ */
      #emotion-icons {
        display: flex;
        justify-content: center; /* ä¸­å¤®æƒãˆ */
        gap: 1rem; /* ã‚¢ã‚¤ã‚³ãƒ³é–“ã®éš™é–“ */
        width: 100%;
        max-width: 500px; /* ã‚¢ã‚¤ã‚³ãƒ³ã®æœ€å¤§å¹…ã‚’è¨­å®š */
      }

      /* å„æ„Ÿæƒ…ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒœã‚¿ãƒ³ */
      .emotion-button {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 60px; /* å›ºå®šå¹… */
        height: 60px; /* å›ºå®šé«˜ã• */
        background-color: #e0e0e0; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®èƒŒæ™¯è‰² */
        border-radius: 50%; /* å††å½¢ */
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.1s; /* èƒŒæ™¯è‰²ã¨å¤‰å½¢ã®ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ */
        flex-shrink: 0; /* ã‚¢ã‚¤ã‚³ãƒ³ãŒç¸®å°ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ */
        /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’ç„¡åŠ¹ã«ã™ã‚‹ */
        -webkit-user-select: none; /* Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE10+ */
        user-select: none; /* Standard */
      }
      .emotion-button:hover {
        background-color: #d0d0d0; /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰² */
      }

      /* æ„Ÿæƒ…çµµæ–‡å­—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .emotion-emoji {
        font-size: 2.5rem; /* çµµæ–‡å­—ã®ã‚µã‚¤ã‚º */
        line-height: 1; /* è¡Œã®é«˜ã•ã‚’èª¿æ•´ */
        transition: transform 0.1s;
        /* ãƒ†ã‚­ã‚¹ãƒˆé¸æŠã‚’ç„¡åŠ¹ã«ã™ã‚‹ */
        -webkit-user-select: none; /* Safari */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* IE10+ */
        user-select: none; /* Standard */
      }

      /* ç¢ºå®šãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      #submit-emotion {
        padding: 0.75rem 2rem;
        background-color: #28a745; /* ç·‘è‰² */
        color: white;
        border: none;
        border-radius: 2rem; /* ä¸¸ã¿ã‚’å¸¯ã³ãŸãƒœã‚¿ãƒ³ */
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* å½± */
        transition: background-color 0.2s, transform 0.1s;
        width: calc(100% - 2rem); /* å·¦å³ã«1remãšã¤ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è€ƒæ…®ã—ãŸå¹… */
        max-width: 400px; /* æœ€å¤§å¹…ã‚’è¨­å®š */
      }
      #submit-emotion:hover {
        background-color: #218838; /* ãƒ›ãƒãƒ¼æ™‚ã®èƒŒæ™¯è‰² */
        transform: translateY(-2px); /* ãƒ›ãƒãƒ¼æ™‚ã«å°‘ã—ä¸Šã«ç§»å‹• */
      }
      #submit-emotion:active {
        transform: translateY(0); /* ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å…ƒã«æˆ»ã‚‹ */
      }

      /* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¨ãƒœãƒƒã‚¯ã‚¹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .message-box-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* åŠé€æ˜ã®é»’èƒŒæ™¯ */
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999; /* æœ€å‰é¢ã«è¡¨ç¤º */
      }
      .message-box {
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 80%;
      }
      .message-box button {
        margin-top: 15px;
        padding: 8px 20px;
        background-color: #007aff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <!-- åœ°å›³ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ã®ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="map-container">
      <div id="controls">
        è¡¨ç¤ºç¯„å›²:
        <select id="range" class="rounded-md p-1 border">
          <option value="20">20m</option>
          <option value="50">50m</option>
          <option value="100" selected>100m</option>
        </select>
      </div>
      <button id="toggleMapControl" class="rounded-md">
        æ“ä½œãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹
      </button>
      <div id="map"></div>
    </div>

    <!-- æ„Ÿæƒ…å…¥åŠ›UIã‚³ãƒ³ãƒ†ãƒŠ -->
    <div id="emotion-input-container">
      <div id="emotion-icons">
        <button class="emotion-button" data-emotion="happy">
          <span class="emotion-emoji">ğŸ˜Š</span>
        </button>
        <button class="emotion-button" data-emotion="angry">
          <span class="emotion-emoji">ğŸ˜ </span>
        </button>
        <button class="emotion-button" data-emotion="sad">
          <span class="emotion-emoji">ğŸ˜¢</span>
        </button>
        <button class="emotion-button" data-emotion="joy">
          <span class="emotion-emoji">ğŸ˜„</span>
        </button>
      </div>
      <button id="submit-emotion">æ„Ÿæƒ…ã‚’ç¢ºå®šã—ã¦é€ä¿¡</button>
    </div>

    <script>
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°å®šç¾©
      let map; // Googleãƒãƒƒãƒ—ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
      let currentLocation = null; // ç¾åœ¨åœ° (ç·¯åº¦ãƒ»çµŒåº¦)
      let mapLocked = true; // åœ°å›³ã®æ“ä½œãƒ­ãƒƒã‚¯çŠ¶æ…‹
      const markers = []; // åœ°å›³ä¸Šã®æ„Ÿæƒ…ãƒãƒ¼ã‚«ãƒ¼ã‚’ç®¡ç†ã™ã‚‹é…åˆ—

      // åœ°å›³ã®ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«è¨­å®š (è·é›¢ã¨ã‚ºãƒ¼ãƒ ã®å¯¾å¿œ)
      const zoomLevels = {
        20: 20, // 20m ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«20
        50: 19, // 50m ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«19
        100: 18, // 100m ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«18 (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
      };

      // æ„Ÿæƒ…ã«é–¢ã™ã‚‹çŠ¶æ…‹ç®¡ç†
      const emotionTapCounts = { happy: 0, angry: 0, sad: 0, joy: 0 }; // å„æ„Ÿæƒ…ã®ã‚¿ãƒƒãƒ—å›æ•°
      const emotionLongPressDurations = { happy: 0, angry: 0, sad: 0, joy: 0 }; // å„æ„Ÿæƒ…ã®é•·æŠ¼ã—æ™‚é–“ (ãƒŸãƒªç§’)
      let pressTimer; // é•·æŠ¼ã—åˆ¤å®šç”¨ã®ã‚¿ã‚¤ãƒãƒ¼
      let lastInteractedEmotion = null; // æœ€å¾Œã«æ“ä½œã•ã‚ŒãŸæ„Ÿæƒ… (æ–‡å­—åˆ—: 'happy', 'angry'ãªã©)

      /**
       * ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
       * alert()ã®ä»£ã‚ã‚Šã«ã“ã‚Œã‚’ä½¿ç”¨ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€šçŸ¥ã—ã¾ã™ã€‚
       * @param {string} message - è¡¨ç¤ºã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
       */
      function showMessageBox(message) {
        const overlay = document.createElement("div");
        overlay.className = "message-box-overlay";
        const messageBox = document.createElement("div");
        messageBox.className = "message-box";
        messageBox.innerHTML = `<p>${message}</p><button>OK</button>`;
        overlay.appendChild(messageBox);
        document.body.appendChild(overlay);

        // OKãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒœãƒƒã‚¯ã‚¹ã‚’é–‰ã˜ã‚‹
        messageBox.querySelector("button").onclick = () => {
          document.body.removeChild(overlay);
        };
      }

      /**
       * Googleãƒãƒƒãƒ—ã‚’åˆæœŸåŒ–ã™ã‚‹é–¢æ•°ã€‚
       * APIã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒèª­ã¿è¾¼ã¾ã‚ŒãŸå¾Œã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚
       */
      function initMap() {
        // åœ°å›³ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« (ç°è‰²ã§ãƒ©ãƒ™ãƒ«ãªã—) ã‚’å®šç¾©
        const styledMapType = new google.maps.StyledMapType(
          [
            { elementType: "geometry", stylers: [{ color: "#f5f5f5" }] },
            { elementType: "labels", stylers: [{ visibility: "off" }] },
            { featureType: "administrative", stylers: [{ visibility: "off" }] },
            { featureType: "poi", stylers: [{ visibility: "off" }] },
            {
              featureType: "road",
              elementType: "geometry",
              stylers: [{ color: "#cccccc" }],
            },
            { featureType: "transit", stylers: [{ visibility: "off" }] },
            {
              featureType: "water",
              elementType: "geometry",
              stylers: [{ color: "#e0e0e0" }],
            },
          ],
          { name: "Gray No Labels" }
        );

        // åœ°å›³ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 35.681236, lng: 139.767125 }, // åˆæœŸä¸­å¿ƒåº§æ¨™ï¼ˆæ±äº¬ï¼‰
          zoom: 18,
          disableDefaultUI: true, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆUIã‚’ç„¡åŠ¹ã«ã™ã‚‹
          draggable: false, // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ãƒ‰ãƒ©ãƒƒã‚°ã‚’ç„¡åŠ¹ã«ã™ã‚‹
          gestureHandling: "none", // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ç„¡åŠ¹ã«ã™ã‚‹
          keyboardShortcuts: false, // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ç„¡åŠ¹ã«ã™ã‚‹
        });

        // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åœ°å›³ã«é©ç”¨
        map.mapTypes.set("styled_map", styledMapType);
        map.setMapTypeId("styled_map");

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š ---

        // åœ°å›³æ“ä½œãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document
          .getElementById("toggleMapControl")
          .addEventListener("click", function () {
            mapLocked = !mapLocked; // ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ

            // åœ°å›³ã®æ“ä½œã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æ›´æ–° (ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã«å¿œã˜ã¦ãƒ‰ãƒ©ãƒƒã‚°ã€ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã€ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆ)
            map.setOptions({
              draggable: !mapLocked,
              gestureHandling: mapLocked ? "none" : "greedy", // greedyã¯å¸¸ã«ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’å‡¦ç†
              zoomControl: !mapLocked, // ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®è¡¨ç¤º/éè¡¨ç¤º
            });

            // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
            this.textContent = mapLocked
              ? "æ“ä½œãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹"
              : "æ“ä½œãƒ¢ãƒ¼ãƒ‰ã‚’çµ‚äº†ã™ã‚‹";

            // æ“ä½œãƒ¢ãƒ¼ãƒ‰çµ‚äº†æ™‚ã«åœ°å›³ã®ä¸­å¿ƒã‚’ç¾åœ¨åœ°ã«æˆ»ã™
            if (mapLocked && currentLocation) {
              map.setCenter(currentLocation);
            }
          });

        // ç¾åœ¨åœ°å–å¾—ã¨ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (position) => {
              currentLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude,
              };

              const selectedDistance = document.getElementById("range").value;
              map.setCenter(currentLocation); // ç¾åœ¨åœ°ã‚’ä¸­å¿ƒã«ã™ã‚‹
              map.setZoom(zoomLevels[selectedDistance]); // é¸æŠã•ã‚ŒãŸç¯„å›²ã§ã‚ºãƒ¼ãƒ 

              // ç¾åœ¨åœ°ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ  (é’ã„å††å½¢ã‚¢ã‚¤ã‚³ãƒ³)
              new google.maps.Marker({
                position: currentLocation,
                map: map,
                title: "ã‚ãªãŸã®ç¾åœ¨åœ°",
                icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 7, // ã‚µã‚¤ã‚º
                  fillColor: "#007AFF", // é’è‰²
                  fillOpacity: 1, // ä¸é€æ˜åº¦
                  strokeWeight: 2, // æ ç·šã®å¤ªã•
                  strokeColor: "#ffffff", // æ ç·šã®è‰²
                },
              });
            },
            () =>
              showMessageBox(
                "ç¾åœ¨åœ°ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
              )
          );
        } else {
          showMessageBox("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
        }

        // è¡¨ç¤ºç¯„å›²å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document
          .getElementById("range")
          .addEventListener("change", function () {
            const zoom = zoomLevels[this.value];
            if (map && currentLocation) {
              // åœ°å›³ã¨ç¾åœ¨åœ°ãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚Œã°ã‚ºãƒ¼ãƒ å¤‰æ›´
              map.setZoom(zoom);
            }
          });

        // å®šæœŸçš„ã«æ„Ÿæƒ…ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒã—ã¦è¡¨ç¤º (10ç§’ã”ã¨)
        setInterval(fetchAndDisplayEmotionMapData, 10000);
      }

      /**
       * HSL (è‰²ç›¸ã€å½©åº¦ã€æ˜åº¦) ã‚’ HEX (16é€²æ•°) å½¢å¼ã®è‰²ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹é–¢æ•°
       * @param {number} h - è‰²ç›¸ (0-360)
       * @param {number} s - å½©åº¦ (0-100)
       * @param {number} l - æ˜åº¦ (0-100)
       * @returns {string} HEXå½¢å¼ã®è‰²ã‚³ãƒ¼ãƒ‰ (ä¾‹: "#RRGGBB")
       */
      function hslToHex(h, s, l) {
        h /= 360;
        s /= 100;
        l /= 100;
        let r, g, b;
        if (s === 0) {
          r = g = b = l; // ç„¡å½©è‰² (ç°è‰²)
        } else {
          const hue2rgb = (p, q, t) => {
            if (t < 0) t += 1;
            if (t > 1) t -= 1;
            if (t < 1 / 6) return p + (q - p) * 6 * t;
            if (t < 1 / 2) return q;
            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
            return p;
          };
          const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
          const p = 2 * l - q;
          r = hue2rgb(p, q, h + 1 / 3);
          g = hue2rgb(p, q, h);
          b = hue2rgb(p, q, h - 1 / 3);
        }
        const toHex = (x) => {
          const hex = Math.round(x * 255).toString(16);
          return hex.length === 1 ? "0" + hex : hex;
        };
        return `#${toHex(r)}${toHex(g)}${toHex(b)}`;
      }

      /**
       * æ„Ÿæƒ…ã€ã‚¿ãƒƒãƒ—å›æ•°ã€é•·æŠ¼ã—æ™‚é–“ã«åŸºã¥ã„ã¦HEXå½¢å¼ã®è‰²ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
       * @param {string} emotion - æ„Ÿæƒ…ã®ç¨®é¡ ('happy', 'angry'ãªã©)
       * @param {number} tapCount - ã‚¿ãƒƒãƒ—å›æ•°
       * @param {number} longPressDuration - é•·æŠ¼ã—æ™‚é–“ (ãƒŸãƒªç§’)
       * @returns {string} ç”Ÿæˆã•ã‚ŒãŸHEXè‰²ã‚³ãƒ¼ãƒ‰
       */
      function generateColorCode(emotion, tapCount, longPressDuration) {
        let hue, saturation, lightness;

        // æ„Ÿæƒ…ã®ç¨®é¡ã«å¿œã˜ã¦è‰²ç›¸ (Hue) ã‚’è¨­å®š
        switch (emotion) {
          case "happy":
            hue = 60;
            break; // ç¬‘é¡”: é»„è‰²ç³»
          case "angry":
            hue = 0;
            break; // æ€’ã‚Š: èµ¤è‰²ç³»
          case "sad":
            hue = 240;
            break; // æ‚²ã—ã¿: é’è‰²ç³»
          case "joy":
            hue = 120;
            break; // å–œã³: ç·‘è‰²ç³»
          default:
            hue = 0; // æœªçŸ¥ã®æ„Ÿæƒ…ã®å ´åˆã¯èµ¤
        }

        // ã‚¿ãƒƒãƒ—å›æ•°ã¨é•·æŠ¼ã—æ™‚é–“ã«åŸºã¥ã„ã¦å½©åº¦ (Saturation) ã¨æ˜åº¦ (Lightness) ã‚’èª¿æ•´
        // ã‚¿ãƒƒãƒ—å›æ•°ãŒå¤šã„ã»ã©å½©åº¦ã‚’é«˜ãã€é•·æŠ¼ã—æ™‚é–“ãŒé•·ã„ã»ã©æ˜åº¦ã‚’é«˜ã
        saturation = Math.min(100, 50 + tapCount * 5); // å½©åº¦: æœ€å°50, æœ€å¤§100
        lightness = Math.min(90, 50 + longPressDuration / 100); // æ˜åº¦: æœ€å°50, æœ€å¤§90

        return hslToHex(hue, saturation, lightness);
      }

      // --- æ„Ÿæƒ…ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š ---
      document.querySelectorAll(".emotion-button").forEach((button) => {
        const emotion = button.dataset.emotion; // ãƒœã‚¿ãƒ³ã«è¨­å®šã•ã‚ŒãŸæ„Ÿæƒ…å (ä¾‹: 'happy')
        let pressStartTime = 0; // ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚åˆ»
        let isLongPress = false; // é•·æŠ¼ã—ãŒç™ºç”Ÿã—ãŸã‹ã©ã†ã‹ã®ãƒ•ãƒ©ã‚°

        // ã‚¿ãƒƒãƒé–‹å§‹ / ãƒã‚¦ã‚¹ãƒ€ã‚¦ãƒ³æ™‚ã®å‡¦ç†
        const handlePressStart = (e, btn, emo) => {
          e.preventDefault(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆé¸æŠã€ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãªã©ï¼‰ã‚’é˜²æ­¢
          lastInteractedEmotion = emo; // æœ€å¾Œã«æ“ä½œã•ã‚ŒãŸæ„Ÿæƒ…ã‚’è¨˜éŒ²
          pressStartTime = new Date().getTime(); // æŠ¼ä¸‹é–‹å§‹æ™‚åˆ»ã‚’è¨˜éŒ²
          isLongPress = false; // é•·æŠ¼ã—ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ

          // æ—¢å­˜ã®é•·æŠ¼ã—ã‚¿ã‚¤ãƒãƒ¼ãŒã‚ã‚Œã°ã‚¯ãƒªã‚¢ã—ã€æ–°ã—ã„ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹
          clearTimeout(pressTimer);
          pressTimer = setTimeout(() => {
            isLongPress = true; // é•·æŠ¼ã—ã¨åˆ¤å®š
            const duration = new Date().getTime() - pressStartTime;
            emotionLongPressDurations[emo] = duration; // é•·æŠ¼ã—æ™‚é–“ã‚’è¨˜éŒ²
            console.log(`${emo} é•·æŠ¼ã—æ™‚é–“: ${duration}ms`);

            // é•·æŠ¼ã—ãŒç¢ºå®šã—ãŸã‚‰ã€ãã®æ™‚ç‚¹ã®é•·æŠ¼ã—æ™‚é–“ã‚’åæ˜ ã—ãŸè‰²ã‚’é©ç”¨
            const currentColor = generateColorCode(
              emo,
              emotionTapCounts[emo],
              emotionLongPressDurations[emo]
            );
            btn.style.backgroundColor = currentColor;
          }, 500); // 500msä»¥ä¸Šã§é•·æŠ¼ã—ã¨åˆ¤å®š

          // ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸç›´å¾Œã«è‰²ã‚’å¤‰åŒ–ã•ã›ã‚‹ï¼ˆå³åº§ã®è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
          // ã“ã®æ™‚ç‚¹ã§ã¯é•·æŠ¼ã—æ™‚é–“ã¯0ã¨ã—ã¦è‰²ã‚’ç”Ÿæˆ
          const currentColorOnPress = generateColorCode(
            emo,
            emotionTapCounts[emo],
            0
          );
          btn.style.backgroundColor = currentColorOnPress;
        };

        // ã‚¿ãƒƒãƒçµ‚äº† / ãƒã‚¦ã‚¹ã‚¢ãƒƒãƒ—æ™‚ã®å‡¦ç†
        const handlePressEnd = (btn, emo) => {
          clearTimeout(pressTimer); // é•·æŠ¼ã—ã‚¿ã‚¤ãƒãƒ¼ã‚’åœæ­¢
          pressTimer = null;

          if (!isLongPress) {
            // çŸ­ã„ã‚¿ãƒƒãƒ—ã®å ´åˆã®ã¿ã‚¿ãƒƒãƒ—å›æ•°ã‚’å¢—ã‚„ã™
            emotionTapCounts[emo]++; // ã‚¿ãƒƒãƒ—å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
            console.log(`${emo} ã‚¿ãƒƒãƒ—å›æ•°: ${emotionTapCounts[emo]}`);
          } else {
            // é•·æŠ¼ã—å¾Œã®ãƒªãƒªãƒ¼ã‚¹ã§ã¯ã€æ—¢ã«é•·æŠ¼ã—æ™‚é–“ãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚¿ãƒƒãƒ—å›æ•°ã¯å¢—ã‚„ã•ãªã„
          }
          isLongPress = false; // é•·æŠ¼ã—ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ

          // æŒ‡/ãƒã‚¦ã‚¹ã‚’é›¢ã—ãŸã‚‰å…ƒã®è‰²ã«æˆ»ã™ (CSSãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ã§å¾ã€…ã«è–„ããªã‚‹åŠ¹æœ)
          btn.style.backgroundColor = "#e0e0e0";
        };

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ 
        button.addEventListener("touchstart", (e) =>
          handlePressStart(e, button, emotion)
        );
        button.addEventListener("mousedown", (e) =>
          handlePressStart(e, button, emotion)
        );
        button.addEventListener("touchend", () =>
          handlePressEnd(button, emotion)
        );
        button.addEventListener("mouseup", () =>
          handlePressEnd(button, emotion)
        );
        // ãƒã‚¦ã‚¹ãŒãƒœã‚¿ãƒ³ã‹ã‚‰é›¢ã‚ŒãŸå ´åˆã‚‚è‰²ã‚’æˆ»ã™ (PCãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘)
        button.addEventListener("mouseleave", () => {
          if (pressTimer) {
            // é•·æŠ¼ã—ã‚¿ã‚¤ãƒãƒ¼ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå ´åˆã®ã¿
            clearTimeout(pressTimer);
            pressTimer = null;
          }
          button.style.backgroundColor = "#e0e0e0"; // è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
          isLongPress = false; // ãƒ•ãƒ©ã‚°ã‚‚ãƒªã‚»ãƒƒãƒˆ
        });
      });

      // --- ç¢ºå®šãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
      document
        .getElementById("submit-emotion")
        .addEventListener("click", async () => {
          // æœ€å¾Œã«æ“ä½œã•ã‚ŒãŸæ„Ÿæƒ…ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
          if (!lastInteractedEmotion) {
            showMessageBox(
              "ã¾ãšæ„Ÿæƒ…ã‚¢ã‚¤ã‚³ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã¾ãŸã¯é•·æŠ¼ã—ã—ã¦ãã ã•ã„ã€‚"
            );
            return;
          }
          // ç¾åœ¨åœ°ãŒå–å¾—ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
          if (!currentLocation) {
            showMessageBox(
              "ç¾åœ¨åœ°ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ä½ç½®æƒ…å ±ã®è¨±å¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
            );
            return;
          }

          // æ„Ÿæƒ…ã®è‰²ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
          const colorCode = generateColorCode(
            lastInteractedEmotion, // æœ€å¾Œã«æ“ä½œã•ã‚ŒãŸæ„Ÿæƒ…ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
            emotionTapCounts[lastInteractedEmotion],
            emotionLongPressDurations[lastInteractedEmotion]
          );
          const timestamp = new Date().toISOString(); // ç¾åœ¨æ™‚åˆ»ã‚’ISO 8601å½¢å¼ã§å–å¾—

          // ç·¯åº¦ãƒ»çµŒåº¦ã‚’å°æ•°ç‚¹ä»¥ä¸‹6æ¡ã«ä¸¸ã‚ã‚‹
          const roundedLatitude = parseFloat(currentLocation.lat.toFixed(6));
          const roundedLongitude = parseFloat(currentLocation.lng.toFixed(6));

          // é€ä¿¡ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
          const data = {
            color: colorCode,
            latitude: roundedLatitude,
            longitude: roundedLongitude,
            timestamp: timestamp,
          };

          console.log("é€ä¿¡ãƒ‡ãƒ¼ã‚¿:", data);

          // --- ãƒ‡ãƒ¼ã‚¿é€ä¿¡å‡¦ç† (ãƒ€ãƒŸãƒ¼) ---
          // å®Ÿéš›ã«ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã¸POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¾ã™
          try {
            // const response = await fetch('/api/emotion', { // å®Ÿéš›ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
            //   method: 'POST',
            //   headers: { 'Content-Type': 'application/json' },
            //   body: JSON.stringify(data)
            // });
            // if (!response.ok) {
            //   const errorText = await response.text();
            //   throw new Error(`HTTP ${response.status}: ${errorText}`);
            // }
            // const result = await response.json();
            // console.log('é€ä¿¡æˆåŠŸ:', result);

            // ç¾æ®µéšã§ã¯ãƒ€ãƒŸãƒ¼APIå‘¼ã³å‡ºã— (å®Ÿéš›ã«ã¯å¤–éƒ¨ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‰ãšæˆåŠŸã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ)
            const response = await postDataToEmocloud(
              data.color,
              data.latitude,
              data.longitude,
              data.timestamp
            );
            if (response) {
              // ãƒ€ãƒŸãƒ¼é–¢æ•°ãŒæˆåŠŸã‚’è¿”ã—ãŸå ´åˆ
              showMessageBox("æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ãŒé€ä¿¡ã•ã‚Œã¾ã—ãŸï¼");
              // é€ä¿¡å¾Œã€ã™ã¹ã¦ã®æ„Ÿæƒ…ã®ã‚¿ãƒƒãƒ—å›æ•°ã¨é•·æŠ¼ã—æ™‚é–“ã‚’ãƒªã‚»ãƒƒãƒˆ
              for (const key in emotionTapCounts) {
                emotionTapCounts[key] = 0;
                emotionLongPressDurations[key] = 0;
              }
              lastInteractedEmotion = null; // æœ€å¾Œã«æ“ä½œã•ã‚ŒãŸæ„Ÿæƒ…ã‚‚ãƒªã‚»ãƒƒãƒˆ
            } else {
              showMessageBox(
                "æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
              );
            }
          } catch (error) {
            console.error("ãƒ‡ãƒ¼ã‚¿é€ä¿¡ã‚¨ãƒ©ãƒ¼:", error);
            showMessageBox("ãƒ‡ãƒ¼ã‚¿é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
          }
        });

      /**
       * ãƒ€ãƒŸãƒ¼ã®POSTå‡¦ç†é–¢æ•°
       * å®Ÿéš›ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã¸ã®å‘¼ã³å‡ºã—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚
       * @param {string} color - è‰²ã‚³ãƒ¼ãƒ‰
       * @param {number} latitude - ç·¯åº¦
       * @param {number} longitude - çµŒåº¦
       * @param {string} timestamp - ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
       * @returns {Promise<object|null>} æˆåŠŸã—ãŸå ´åˆã¯ãƒ‡ãƒ¼ã‚¿ã€å¤±æ•—ã—ãŸå ´åˆã¯nullã‚’è§£æ±ºã™ã‚‹Promise
       */
      async function postDataToEmocloud(color, latitude, longitude, timestamp) {
        // æ³¨: ã“ã®URLã¯ãƒ€ãƒŸãƒ¼ã§ã™ã€‚å®Ÿéš›ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚
        // const url = 'https://tyho3rn3ca.execute-api.ap-southeast-2.amazonaws.com/emocloudData';

        console.log("--- ãƒ€ãƒŸãƒ¼POSTå‡¦ç†å®Ÿè¡Œä¸­ ---");
        console.log("è‰²:", color);
        console.log("ç·¯åº¦:", latitude);
        console.log("çµŒåº¦:", longitude);
        console.log("ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—:", timestamp);
        console.log("---------------------------");

        // æˆåŠŸã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹Promise (500msã®é…å»¶ã‚’ä¼´ã†)
        return new Promise((resolve) => {
          setTimeout(() => {
            resolve({
              message: "Dummy POST successful",
              data: { color, latitude, longitude, timestamp },
            });
          }, 500);
        });
      }

      /**
       * ãƒ€ãƒŸãƒ¼ã®æ„Ÿæƒ…ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹é–¢æ•°
       * å®Ÿéš›ã«ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‹ã‚‰ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒã—ã¾ã™ã€‚
       * @returns {Promise<Array<object>>} ãƒ€ãƒŸãƒ¼ã®æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‚’è§£æ±ºã™ã‚‹Promise
       */
      async function fetchEmotionMapData() {
        console.log("æ„Ÿæƒ…ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒä¸­...");
        // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ (ç¾åœ¨åœ°å‘¨è¾ºã«ãƒ©ãƒ³ãƒ€ãƒ ãªæ„Ÿæƒ…ãƒãƒ¼ã‚«ãƒ¼ã‚’ç”Ÿæˆ)
        const dummyData = [
          {
            color: "#FF0000",
            latitude: 35.681236 + (Math.random() - 0.5) * 0.01,
            longitude: 139.767125 + (Math.random() - 0.5) * 0.01,
            timestamp: new Date().toISOString(),
          },
          {
            color: "#00FF00",
            latitude: 35.681236 + (Math.random() - 0.5) * 0.01,
            longitude: 139.767125 + (Math.random() - 0.5) * 0.01,
            timestamp: new Date().toISOString(),
          },
          {
            color: "#0000FF",
            latitude: 35.681236 + (Math.random() - 0.5) * 0.01,
            longitude: 139.767125 + (Math.random() - 0.5) * 0.01,
            timestamp: new Date().toISOString(),
          },
          {
            color: "#FFFF00",
            latitude: 35.681236 + (Math.random() - 0.5) * 0.01,
            longitude: 139.767125 + (Math.random() - 0.5) * 0.01,
            timestamp: new Date().toISOString(),
          },
          {
            color: "#FF00FF",
            latitude: 35.681236 + (Math.random() - 0.5) * 0.01,
            longitude: 139.767125 + (Math.random() - 0.5) * 0.01,
            timestamp: new Date().toISOString(),
          },
          {
            color: "#00FFFF",
            latitude: 35.681236 + (Math.random() - 0.5) * 0.01,
            longitude: 139.767125 + (Math.random() - 0.5) * 0.01,
            timestamp: new Date().toISOString(),
          },
        ];
        return new Promise((resolve) =>
          setTimeout(() => resolve(dummyData), 1000)
        ); // 1ç§’ã®é…å»¶ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
      }

      /**
       * åœ°å›³ä¸Šã®æ—¢å­˜ã®æ„Ÿæƒ…ãƒãƒ¼ã‚«ãƒ¼ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã™ã‚‹é–¢æ•°
       */
      function clearMarkers() {
        for (let i = 0; i < markers.length; i++) {
          markers[i].setMap(null); // ãƒãƒ¼ã‚«ãƒ¼ã‚’åœ°å›³ã‹ã‚‰å‰Šé™¤
        }
        markers.length = 0; // ãƒãƒ¼ã‚«ãƒ¼é…åˆ—ã‚’ç©ºã«ã™ã‚‹
      }

      /**
       * æ„Ÿæƒ…ãƒãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚§ãƒƒãƒã—ã€åœ°å›³ä¸Šã«è¡¨ç¤ºã™ã‚‹é–¢æ•°
       */
      async function fetchAndDisplayEmotionMapData() {
        const emotionData = await fetchEmotionMapData(); // æ„Ÿæƒ…ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        if (emotionData && map) {
          clearMarkers(); // æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢

          emotionData.forEach((data) => {
            // å„ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒˆã«å¯¾ã—ã¦æ„Ÿæƒ…ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
            const marker = new google.maps.Marker({
              position: { lat: data.latitude, lng: data.longitude },
              map: map,
              icon: {
                path: google.maps.SymbolPath.CIRCLE, // å††å½¢ã‚¢ã‚¤ã‚³ãƒ³
                scale: 10, // ãƒãƒ¼ã‚«ãƒ¼ã®ã‚µã‚¤ã‚º
                fillColor: data.color, // æ„Ÿæƒ…ã®è‰²ã‚³ãƒ¼ãƒ‰
                fillOpacity: 0.7, // ä¸é€æ˜åº¦
                strokeWeight: 1, // æ ç·šã®å¤ªã•
                strokeColor: "#ffffff", // æ ç·šã®è‰²
              },
              title: `æ„Ÿæƒ…: ${data.color}, æ™‚åˆ»: ${new Date(
                data.timestamp
              ).toLocaleString()}`, // ãƒãƒ¼ã‚«ãƒ¼ã®ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
            });
            markers.push(marker); // ãƒãƒ¼ã‚«ãƒ¼ã‚’é…åˆ—ã«è¿½åŠ 
          });
        }
      }
    </script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC0gZqkL68rgvnjUU7fNmVfRyydR-lDBaA&callback=initMap"
      async
      defer
    ></script>
  </body>
</html>
